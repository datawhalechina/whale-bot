# 🐋 WhaleBot 硬件设计与焊接指南

本文档说明了 WhaleBot 智能小车的硬件架构、PCB 设计规范及组装流程。

> 🌟 **欢迎加入【星芯工坊】社区**
> 如果你在制作过程中遇到了硬件调试疑难或希望参与新功能共创，欢迎加入：
> *   **群名称**：星芯工坊
> *   **QQ群号**：[571656123]

---

## 📐 1. PCB 设计与布线规范

在根据原理图进行 PCB 布局布线时，请务必遵循以下物理特性要求：

### 1.1 电源路径与线宽
根据原理图，电路包含三级电压，需按电流大小分配线宽：
*   **12V 动力线 (VBAT_12V)**：由 DC-005 输入，经过 SW1 开关和 F1 保险丝，直通两个 TB6612 的 VM 脚。建议线宽 **≥ 40mil**。
*   **5V 主供电 (+5V)**：经 U78 一级降压输出，供给 ASRPRO、串口屏和 MAX98357 功放。建议线宽 **≥ 25mil**。
*   **3.3V 逻辑电 (3V3)**：由 H78 (AMS1117 模块) 二级降压输出，供给 ESP32-S3 和 INMP441 麦克风。建议线宽 **≥ 15mil**。

### 1.2 信号完整性布局
1.  **音频保护**：U5 (麦克风) 和 U6 (功放) 属于敏感模拟/数字混合信号，应尽量远离 U3/U4 (电机驱动) 的高频 PWM 走线。
2.  **地线铺铜**：建议全板大面积铺 GND 铜箔，以降低阻抗并辅助散热。

---

## 🧩 2. 元器件清单 (BOM)

请对照原理图各功能框图准备以下元件：

### A. 核心模块
*   **MCU**: ESP32S3-DevKitC - 1个
*   **语音模块**: ASRPRO51 天问开发板 - 1个
*   **电机驱动**: TB6612FNG (正面插接) - 2个 (U3, U4)

### B. 电源与保护
*   **保险丝 (F1)**: SMD0805-050C-30V (0.5A/30V 自恢复) - 1个
*   **防反接/续流 (D1, D2)**: SS34 (肖特基二极管) - 2个
*   **一级降压 (U78)**: 12V 转 5V 降压模块 (4引脚封装) - 1个
*   **二级降压 (H78)**: PM254V-11-03 (AMS1117-3.3 模块) - 1个
*   **滤波电容 (C1)**: 100nF (104) 陶瓷电容 - 1个
*   **接插件**: DC-005 电源座、KCD1-101 开关、KF301R-5.0-2P 端子 (4个)

### C. 音频与交互
*   **麦克风 (U5)**: INMP441 I2S 模块 - 1个
*   **功放 (U6)**: MAX98357A I2S 模块 - 1个
*   **串口屏接口 (H1)**: 2.54mm 4P 排针 - 1个

---

## 🔌 3. 硬件引脚对应表 (严格对照原理图)

### 3.1 电机驱动 (ESP32 -> TB6612)
| 轮位 | 引脚功能 | ESP32-S3 引脚 |
| :--- | :--- | :--- |
| **左前 (FL)** | AIN1/AIN2 / PWMA | IO41 / IO42 / **IO40** |
| **右前 (FR)** | BIN1/BIN2 / PWMB | IO39 / IO38 / **IO48** |
| **左后 (RL)** | AIN1/AIN2 / PWMA | IO11 / IO10 / **IO12** |
| **右后 (RR)** | BIN1/BIN2 / PWMB | IO14 / IO13 / **IO21** |

### 3.2 音频系统 (ESP32 I2S)
*   **麦克风 (INMP441)**: WS -> **IO5** | SD -> **IO6** | SCK -> **IO4**
*   **功放 (MAX98357)**: LRC -> **IO16** | BCLK -> **IO8** | DIN -> **IO7**

### 3.3 串口通信 (ESP32-ASRPRO-屏幕)
*   **ESP32 侧**: TX -> **IO17** | RX -> **IO18**
*   **通信对象**: 该总线同时挂载 ASRPRO 的 PA2/PA3 及串口屏的 TX/RX。

---

## 👨‍🏭 4. 焊接与上电检查流程

### 4.1 焊接要点
1.  **高度优先**：先焊接贴片 F1、D1、D2 和 C1，再焊接排母和接线端子。
2.  **方向确认**：
    *   **D1/D2** 极性带杠的一端为负极，严禁焊反。
    *   **TB6612** 模块安装时，确认其 VM 脚对应原理图中的 12V 供电方向。

### 4.2 关键电压测试 (通电前必测)
在插入 ESP32 和模块前，接入 12V 电源，使用万用表测量排母：
1.  测量 `+5V` 与 `GND`：应稳定在 **5V ± 0.2V**。
2.  测量 `3V3` 与 `GND`：应稳定在 **3.3V ± 0.1V**。
3.  测量 `VM` (电机驱动排母第16脚)：应为 **12V** 电池电压。

---

## ⚠️ 常见问题排查 (FAQ)

**Q1: 电机不工作，但代码逻辑正常？**
*   检查 TB6612 的 `STBY` 引脚是否正确接入 3.3V。
*   检查 F1 保险丝是否因瞬时大电流熔断。

**Q2: 麦克风有严重杂音？**
*   检查 U5 的电源是否接在 3.3V（原理图设计），若误接 5V 会导致芯片性能衰减或烧毁。
*   确认电路板上麦克风附近的走线是否有高频干扰。

**Q3: 语音模块与串口屏冲突？**
*   原理图上 ASRPRO 与屏幕共用总线。请确保两者不会同时发送数据，或通过代码分配不同的握手逻辑。

---

**星芯工坊 - WhaleBot 硬件小组**
*版本：V1.0 | 日期：2026-01-07*