# 🛠️ WhaleBot 硬件设计与焊接指南

本文档详细说明了 WhaleBot 智能鲸鱼小车的 PCB 设计注意事项及元器件焊接、组装流程。请结合 `schematic.pdf` 原理图进行操作。

> 🌟 **欢迎加入【星芯工坊】社区喵**

> 如果你在制作过程中遇到了“玄学问题”，需要**避坑指南**，或者希望获得**后续开发支持**与志同道合的 Maker 进行**技术交流**，欢迎加入我们的“星芯工坊”大家庭喵！
>
> *   **群名称**：星芯工坊
> *   **QQ群号**：[571656123]
> *   **交流重点**：硬件调试疑难 / 代码逻辑探讨 / 新功能共创

## 📐 1. PCB 设计与打板说明

本项目原理图已经过验证，如果你需要重新绘制或修改 PCB，请务必遵守以下设计规则，以确保电源稳定和信号完整。

### 1.1 电源线宽 (Trace Width)
为了防止大电流烧断线路或压降过大，请遵守以下线宽规则：
*   **12V 动力线 (VBAT_12V)**：必须足够粗，建议 **> 40 mil (1.0mm)**。电流主要流向电机驱动模块。
*   **5V 主供电 (+5V)**：建议 **> 25 mil (0.6mm)**。供给功放、串口屏和 ASRPRO。
*   **3.3V 逻辑电 (3V3)**：建议 **> 15 mil (0.4mm)**。供给 ESP32 和传感器。
*   **GND (地线)**：建议全板铺铜 (Copper Pour)，保证良好散热和接地。

### 1.2 关键布局 (Layout Guidelines)
1.  **电源模块 (TPS5430)**：
    *   输入电容 (10uF) 必须紧贴芯片的 VIN 和 GND 引脚。
    *   二极管 (SS34) 和电感 (33uH) 应尽可能靠近 PH 引脚。
2.  **音频部分**：
    *   麦克风 (INMP441) 和 功放 (MAX98357) 应尽量远离电源模块（电感）和电机驱动，防止引入电磁底噪。
    *   I2S 信号线尽量并行走线。
3.  **ESP32 天线**：
    *   ESP32-S3 开发板的天线区域下方 **严禁铺铜或走线** (Keepout Area)，否则会严重影响 WiFi 信号，导致语音对话卡顿。

---

## 🧩 2. 元器件清单 (BOM)

请对照原理图准备以下元件：

### A. 主控与核心模块
*   **U1**: ESP32-S3-DevKitC 开发板 (推荐 N16R8 配置) - 1个
*   **U2**: 天问 ASRPRO 语音识别模块 - 1个

### B. 电源管理 (核心心脏)
*   **U7**: TPS5430DDAR (降压芯片 12V转5V) - 1个
*   **L1**: 功率电感 33uH (CD127封装, 3A以上) - 1个
*   **D1**: SS34 肖特基二极管 - 1个
*   **U8**: AMS1117-3.3 (降压芯片 5V转3.3V) - 1个
*   **DC1**: DC-005 电源插座 (5.5*2.1mm) - 1个
*   **SW1**: KCD1-101 船型开关 (2脚) - 1个
*   **电容**:
    *   220uF/16V 电解电容 (5V滤波) - 1个
    *   10uF 陶瓷电容/电解电容 (输入滤波) - 2个
    *   100nF (104) 陶瓷电容 - 若干
    *   100nF (104) 自举电容 - 1个

### C. 电机驱动
*   **U3, U4**: TB6612FNG 电机驱动模块 - 2个
*   **C_VM**: 100uF/25V 电解电容 (电机电源滤波, **耐压必须要高**) - 2个
*   **接口**: KF128-2.54-2P 接线端子 - 4个

### D. 音频系统
*   **U5**: INMP441 全向麦克风模块 (I2S) - 1个
*   **U6**: MAX98357A 音频功放模块 (I2S) - 1个

### E. 其他
*   **排母**: 2.54mm 间距 (用于插接所有模块) - 若干
*   **LED**: 0805 LED (电源指示) - 1个
*   **电阻**: 1kΩ, 10kΩ, 3.24kΩ (TPS5430反馈用) - 若干

---

## 👨‍🏭 3. 焊接与组装流程

### 3.1 焊接顺序 (由低到高)
建议按照元件高度从低到高的顺序焊接，方便操作。

1.  **第一步：贴片元件 (背面/正面)**
    *   焊接电阻、小电容 (104)、二极管 (SS34)、TPS5430 芯片、AMS1117 芯片。
    *   **注意**：二极管 SS34 有横杠的一端是负极，对应 PCB 丝印上的横线。
2.  **第二步：接线端子与大电容**
    *   焊接 DC 电源座、KF128 电机端子。
    *   焊接电解电容（注意长脚是正极，PCB上通常有白色阴影的是负极）。
3.  **第三步：排母插座**
    *   焊接 ESP32、天问ASR、TB6612、麦克风、功放的排母。
    *   **强烈建议使用排母**，不要把模块直接焊死在板子上，方便排查问题和更换。
4.  **第四步：直插元件**
    *   焊接船型开关、大电感 L1。

### 3.2 硬件连接与检查 (通电前必做！)

在插上昂贵的芯片之前，必须进行电源检查：

1.  **电源短路检查**：
    *   使用万用表蜂鸣档，测试 `12V` 与 `GND`、`5V` 与 `GND`、`3V3` 与 `GND` 是否短路。
    *   **如有短路，严禁通电！**
2.  **空载电压检查**：
    *   接入 12V 电池，打开开关。
    *   用万用表电压档测量各排母的电源脚：
        *   ESP32 排母的 5V 脚应为 **5V ±0.2V**。
        *   TB6612 排母的 VM 脚应为 **12V**。
        *   麦克风排母的 VDD 脚应为 **3.3V** (严禁是5V，否则烧麦克风)。
3.  **模块安装**：
    *   确认电压正常后，断电。
    *   按照 PCB 丝印方向插上所有模块。
    *   **TB6612 方向**：注意模块上的 VM/VCC/GND 引脚要和 PCB 丝印一一对应。

---

## ⚠️ 常见问题排查 (FAQ)

**Q1: 上电后电源指示灯不亮？**
*   检查电池是否有电。
*   检查船型开关是否打开。
*   检查 TPS5430 的 5V 输出是否正常。

**Q2: 麦克风无法录音或全是噪音？**
*   检查 INMP441 的 `L/R` 引脚是否接地（左声道）。
*   检查是否错误地接到了 5V 电源（麦克风可能已损坏）。

**Q3: 功放喇叭有巨大的“滋滋”声？**
*   检查 12V 转 5V 处的电感和电容是否焊接良好。
*   检查功放模块的 GND 是否接触良好。

**Q4: 电机不转？**
*   检查 TB6612 的 `STBY` 引脚是否已连接到 3.3V 高电平。
*   检查 12V 供电是否到达 TB6612 的 VM 引脚。

祝你焊接顺利，一次点亮！🚀