这份文档已经按照你的要求进行了重新架构和内容扩充，采用了更加专业、美观的 Markdown 格式，增强了逻辑性和可读性。

---

# ASRPRO 与淘晶驰串口屏开发指南

> **导语**：本指南旨在帮助开发者快速掌握 ASRPRO 语音芯片与淘晶驰（TJC）串口屏的联动开发。通过本方案，你可以实现“语音控制显示”与“屏幕触摸反馈”的深度交互。

---

## 一、 序章：思维的转变

如果你曾经使用过 **IIC 屏幕、SPI 屏幕或并口屏**，请在开始前**暂时忘掉**它们的开发逻辑。

*   **传统屏幕**：主控（MCU）负责计算每一个像素点，刷新波形，占用大量内存和运算资源。
*   **淘晶驰串口屏**：属于“智能屏”。UI 逻辑、图片渲染、字体显示、甚至简单的逻辑运算都在屏幕内部的处理器上完成。

**核心差异**：
*   **开发重心**：从“在代码里画图”转变为“在上位机软件（USART-HMI）里拖拽控件”。
*   **通信逻辑**：单片机只需通过串口发送一行简单的文本指令（如 `t0.txt="123"`），即可改变显示内容。

---

## 二、 硬件连接方案

ASRPRO 与串口屏通过 TTL 串口进行全双工通信。

### 2.1 标准接线表
| ASRPRO 引脚 | 串口屏引脚 | 说明 |
| :--- | :--- | :--- |
| **5V** | **5V** | 供电（务必保证电源电流充足，背光全亮时耗电较大） |
| **GND** | **GND** | 共地 |
| **PA3 (TX)** | **RX** | ASRPRO 发送，屏幕接收 |
| **PA2 (RX)** | **TX** | 屏幕发送，ASRPRO 接收 |

> **⚠️ 注意**：
> 1. 请务必交叉连接（TX 接 RX，RX 接 TX）。
> 2. 如果使用自定义 PCB，请直接将 ASRPRO 和屏幕插入对应插槽，无需额外接线。

---

## 三、 软件环境配置

开发串口屏的第一步是安装官方配套的设计软件。

1.  **软件名称**：USART-HMI
2.  **下载地址**：[淘晶驰官方下载页](http://wiki.tjc1688.com/download/usart_hmi.html)
3.  **主要功能**：
    *   界面 UI 设计（拖拽式）。
    *   图片、字库素材管理。
    *   指令集调试（模拟器）。
    *   固件下载。

---

## 四、 串口屏开发流程

串口屏的开发遵循“**先设计资产，后逻辑控制**”的原则。

### 4.1 素材准备与导入
*   **字库导入**：必须在软件内生成并导入字库（.zi格式），否则无法显示汉字。
*   **图片素材**：建议在导入前通过 PS 等软件裁剪好对应屏幕的分辨率。
*   **Flash 管理**：所有图片和字库都占用屏幕的 Flash 空间。**切记：** 删除不用的素材，避免超出存储限制导致下载失败。

### 4.2 核心概念：页面 (Page) 与控件 (Control)
*   **页面 (Page)**：类似幻灯片，一个工程可以有多个页面（如：主页、设置页、数据监测页）。
*   **控件 (Control)**：
    *   `t0` (文本控件)：显示字符串。
    *   `n0` (数字控件)：显示数值。
    *   `b0` (按钮控件)：可交互对象。
    *   `p0` (图片控件)：静态或动态图片展示。

### 4.3 属性与指令
每个控件都有自己的属性，开发者可以通过指令实时修改它们：
*   **静态修改**：在 HMI 软件右侧属性栏直接设置。
*   **动态修改**（由 ASRPRO 发送）：
    *   修改文本：`t0.txt="开启空调"`
    *   修改背景色：`b0.bco=63488` (红色)
    *   切换页面：`page 1`

---

## 五、 通信协议详解

### 5.1 数据结束符 (至关重要)
淘晶驰串口屏的所有指令必须以 **三个连续的十六进制数 `0xFF`** 结尾。
*   **错误示例**：`t0.txt="OK"`
*   **正确示例**：`t0.txt="OK"\xFF\xFF\xFF`

### 5.2 交互逻辑
1.  **ASRPRO → 屏幕**：ASRPRO 识别到语音后，发送指令修改屏幕状态。
2.  **屏幕 → ASRPRO**：用户点击屏幕按钮，屏幕通过串口向 ASRPRO 发送自定义字符串（例如 `clicked_btn1`），ASRPRO 接收并执行相应动作。

*   **详细指令集参考**：[官方指令文档](http://wiki.tjc1688.com/commands/index.html)

---

## 六、 进阶：触摸交互与脚本

串口屏不仅仅是一个显示器，它还具备一定的**逻辑运算能力**。

*   **事件触发**：你可以为按钮设置“按下事件”或“弹起事件”。
*   **内部脚本**：在屏幕端编写简单的代码。
    *   *场景*：点击按钮 A，让文本 t0 的数值自增 1。
    *   *屏幕端代码*：`n0.val=n0.val+1`
*   **优势**：这种简单的 UI 交互逻辑直接在屏幕端运行，无需 ASRPRO 参与，响应速度极快且节省串口带宽。

---

## 七、 调试建议

1.  **使用模拟器**：在 USART-HMI 软件中，点击“运行”可以使用模拟器。你可以通过电脑串口连接 ASRPRO，在不烧录屏幕的情况下调试代码。
2.  **波特率匹配**：淘晶驰屏幕默认波特率通常为 `9600`，但在复杂界面开发中，建议将其设置为 `115200` 以获得更流畅的刷新体验。
3.  **隔离测试**：先用“USB转TTL”模块连接电脑和屏幕，确认指令能控制屏幕，再连接 ASRPRO。

---

**结语**：ASRPRO 与串口屏的结合，是实现“声色兼备”智能硬件的最简方案。只需掌握核心的串口指令发送，你就能做出媲美手机 App 的交互界面。